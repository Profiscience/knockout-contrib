# Contributing

You will need [node][] and [yarn][] installed. You will also need to have [Firefox][] installed to run the router tests.


## Build Scripts

[npm/yarn run scripts][run-scripts] are used for building, testing, etc. Available scripts can be found in the root `package.json`, as well as the `package.json` for each package. They are ran using `yarn <script>` in their respective directories.

e.g.

```bash
$ yarn test
# tests all packages (excluding router, yarn test:router)

$ cd packages/model.builders.base
$ yarn test
# test model.builders.base package
```


## Guidelines

- Maintain consistent coding style. Ensure tslint rules are not broken (`yarn lint`).

- Add unit tests for any new code. [Jest][] is used for testing in all packages except the router, which uses [karma][].

- Don't break existing tests. *Try* to keep coverage the same or better.

- Include examples for components. Update when relevant.

- Update the package README.md and docs when relevant.

- Update the package CHANGELOG.md when relevant.

- Use `yarn generate` for new packages when relevant.

- Don't use `any` unless necessary.


## Metapackages

Some packages do not contain any code themselves, but are rather "metapackages" which re-export the latest version of all of a certain type of package. These packages are generated with the `tasks/generate.ts` script in their resepective directories.

For example, the `bindings` package is a metapackage which exposes all of the `bindings.*` packages, and is generated by running `yarn generate` in the `bindings` package directory.


## Designing Components

[Bootstrap v4][] is used as the base for styling components. For component specific styles, [CSS Modules][] and [cssnext][] are used via [postcss][].

[Use camelCased class names](https://github.com/css-modules/css-modules#naming)

When writing component-specific styles, the `*.css.d.ts` file will need to be updated to prevent compiler errors. This file is generated during a build, and to ease this a `watch` task exists for all components.

To view the component in a browser, use the example, and start `yarn serve:examples` in the repository root. Note, this relies on the `dist/*.css` files being updated to rebuild the examples, so you will need to have `watch` running in the package as well.

e.g.

```bash
$ yarn serve:examples

# in another shell session (tab, screen, etc.)
$ cd packages/component.my-component
$ yarn watch
```


## Linking (Developing with other repositories)

Often you will want to try out a bug-fix or feature in a real-world application before publishing or submitting a PR. However, there are some caveats introduced by the fact that we need all repositories to share the same version of knockout _and_ @types/knockout. The workaround is to use linked copies of these packages wherever they are used. In order to do this you need to clone/download Knockout (and the types) and link them. Due to the structure of DefinitelyTyped, it is easier to obtain these from npm.

Use the following script to set up local copies of Knockout and @types/knockout in the current directory (you DO NOT want to run this inside of a project directory, rather use your common root, e.g. `~/Code`)...

```bash
yarn add @types/knockout knockout --no-lockfile --modules-folder ./ && rm package.json
DIR=$PWD
cd $DIR/@types/knockout && yarn link
cd $DIR/knockout && yarn link
```

Then, in this repo, as well as your project repo, run...

```bash
yarn link @types/knockout knockout
```

[node]: https://nodejs.org
[yarn]: https://yarnpkg.com
[Firefox]: https://www.mozilla.org/en-US/firefox/
[run-scripts]: https://yarnpkg.com/lang/en/docs/cli/run/
[Jest]: https://facebook.github.io/jest/
[karma]: https://karma-runner.github.io/2.0/index.html
[Bootstrap v4]: https://getbootstrap.com/
[CSS Modules]: https://github.com/css-modules/css-modules
[cssnext]: https://cssnext.io/features/
[postcss]: https://postcss.org/